<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/CSS/dash.css">
    <link rel="stylesheet" href="/CSS/addUnidade.css">
    <link rel="stylesheet" href="/CSS/loginCadastro.css">
    <title>Document</title>
</head>

<body>
    <div class="maedetodos">
        <nav class="nav-lateral">
            <div class="logo">
                <a href="/"><img src="../assets/Logo-Camel (1).png" alt="" width="130vh" /></a>
            </div>

            <div class="container-mae">
                <div
                    style="display: flex; text-align: center; flex-direction: column; font-size: 3rem; font-family: Arial, Helvetica, sans-serif; font-weight: 800; margin-top: 35%;">
                    <h6>BEM</h6>
                    <h6>VINDO!</h6>
                </div>

            </div>

        </nav>
        <div class="container-esquerda-add__primeiro-login">

          <div class="container_bolinhas">
            <div>
              <h6>Unidade</h6>
            </div>
            <label class="switch">
              <input type="checkbox" class="checkbox">
              <div class="slider">
                
              </div>
          </label>
          <div>
            <h6>Representante</h6>
          </div>
          </div>
          
         

          <form class="formulario" style="margin: 0;">
            <p class="title">Unidade</p>
            <p class="message">Cadastre sua primeira unidade!</p>
            <label>
              <input class="input" type="text" placeholder="" required="" id="ipt-rua">
              <span>Rua</span>
          </label> 
                    
            <label>
                <input class="input" type="number" placeholder="" required="" id="ipt-numero">
                <span>Número</span>
            </label> 
                
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-complemento">
                <span>Complemento</span>
            </label>
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-cep">
                <span>CEP</span>
            </label>
            <label>
              <input class="input" type="text" placeholder="" required="" id="ipt-nome-unidade">
              <span>Nome unidade</span>
          </label>
            <button type="button" class="btn-53" onclick="prosseguir()">
              <div class="original">PROSSEGUIR</div>
              <div class="letters">

                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                      <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                  </span>
  
              </div>
          </button>
        </form>
            
              
             
            
        </div>

    </div>
</body>

</html>

<script>
    const idProvedora = sessionStorage.getItem('IdProvedora');
    console.log('Valor de idProvedora:', idProvedora);


  var nomeGlobal = "";
  var cpfGlobal = "";
  var emailGlobal = "";
  var senhaGlobal = "";
  var nomeUnidadeGlobal = "";
  var ruaGlobal = "";
  var numeroGlobal = "";
  var complementoGlobal = "";
  var cepGlobal = "";



    const form = document.querySelector('form');

    const toggle = document.querySelector('.checkbox');

    toggle.addEventListener('click', () => {
      if(toggle.checked){

        nomeUnidadeGlobal = document.getElementById('ipt-nome-unidade').value;
        ruaGlobal = document.getElementById('ipt-rua').value;
        numeroGlobal = document.getElementById('ipt-numero').value;
        complementoGlobal = document.getElementById('ipt-complemento').value;
        cepGlobal = document.getElementById('ipt-cep').value;

        form.innerHTML = `
        <p class="title">Representante</p>
            <p class="message">Cadastre o responsável pela unidade!</p>
            <label>
              <input class="input" type="text" placeholder="" required="" id="ipt-nome">
              <span>Nome</span>
          </label> 
                    
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-cpf">
                <span>CPF</span>
            </label> 
                
            <label>
                <input class="input" type="email" placeholder="" required="" id="ipt-email">
                <span>E-mail</span>
            </label>
            <label>
                <input class="input" type="password" placeholder="" required="" id="ipt-senha">
                <span>Senha</span>
            </label>
            <button type="button" class="btn-53" onclick="irParaDash()">
              <div class="original">CADASTRAR</div>
              <div class="letters">

                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">

                      `

                      document.getElementById('ipt-nome').value = nomeGlobal;
                      document.getElementById('ipt-cpf').value = cpfGlobal;
                      document.getElementById('ipt-email').value = emailGlobal;
                      document.getElementById('ipt-senha').value = senhaGlobal;


                    }
                    else{

                      nomeGlobal = document.getElementById('ipt-nome').value;
                      cpfGlobal = document.getElementById('ipt-cpf').value;
                      emailGlobal = document.getElementById('ipt-email').value;
                      senhaGlobal = document.getElementById('ipt-senha').value;

                      form.innerHTML = `
                      <p class="title">Unidade</p>
            <p class="message">Cadastre sua primeira unidade!</p>
            <label>
              <input class="input" type="text" placeholder="" required="" id="ipt-rua">
              <span>Rua</span>
          </label> 
                    
            <label>
                <input class="input" type="number" placeholder="" required="" id="ipt-numero">
                <span>Número</span>
            </label> 
                
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-complemento">
                <span>Complemento</span>
            </label>
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-cep">
                <span>CEP</span>
            </label>
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-nome-unidade">
                <span>Nome unidade</span>
            </label>
            <button type="button" class="btn-53" onclick="prosseguir()">
              <div class="original">PROSSEGUIR</div>
              <div class="letters">

                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                      <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                  </span>
  
              </div>
          </button>
                      `


                     ;

                      document.getElementById('ipt-rua').value = ruaGlobal;
                      document.getElementById('ipt-numero').value = numeroGlobal;
                      document.getElementById('ipt-complemento').value = complementoGlobal;
                      document.getElementById('ipt-cep').value = cepGlobal;
                      document.getElementById('ipt-nome-unidade').value = nomeUnidadeGlobal;
                    }
                  }
                );
    
    function prosseguir(){
      toggle.checked = true;
      nomeUnidadeGlobal = document.getElementById('ipt-nome-unidade').value;
        ruaGlobal = document.getElementById('ipt-rua').value;
        numeroGlobal = document.getElementById('ipt-numero').value;
        complementoGlobal = document.getElementById('ipt-complemento').value;
        cepGlobal = document.getElementById('ipt-cep').value;

        form.innerHTML = `
        <p class="title">Representante</p>
            <p class="message">Cadastre o responsável pela unidade!</p>
            <label>
              <input class="input" type="text" placeholder="" required="" id="ipt-nome">
              <span>Nome</span>
          </label> 
                    
            <label>
                <input class="input" type="text" placeholder="" required="" id="ipt-cpf">
                <span>CPF</span>
            </label> 
                
            <label>
                <input class="input" type="email" placeholder="" required="" id="ipt-email">
                <span>E-mail</span>
            </label>
            <label>
                <input class="input" type="password" placeholder="" required="" id="ipt-senha">
                <span>Senha</span>
            </label>
            <button type="button" class="btn-53" onclick="irParaDash()">
              <div class="original">CADASTRAR</div>
              <div class="letters">

                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">

                      `

                      document.getElementById('ipt-nome').value = nomeGlobal;
                      document.getElementById('ipt-cpf').value = cpfGlobal;
                      document.getElementById('ipt-email').value = emailGlobal;
                      document.getElementById('ipt-senha').value = senhaGlobal;

        
      }
    


   function irParaDash() {
  // Dados que você quer enviar no corpo da requisição
  const fkProvedora = sessionStorage.getItem('idProvedora');
 
   

  // Criando o objeto data
  const data = {
    cep: cepGlobal,
    rua: ruaGlobal,
    numero: numeroGlobal,
    complemento: complementoGlobal,
    nomeUnidade: nomeUnidadeGlobal,
    representante: nomeGlobal,
    email: emailGlobal,
    senha: senhaGlobal,
    fkProvedora: idProvedora
  };

  // Configuração da requisição para cadastrarUnidade
  const requestOptions = {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  };

  // URL do endpoint para cadastrarUnidade
  const urlCadastrarUnidade = '/cadastrarUnidade';

  console.log(fkProvedora);

  // Executando a requisição para cadastrarUnidade
  fetch(urlCadastrarUnidade, requestOptions)
    .then(response => {
      if (!response.ok) {
        throw new Error('Erro na solicitação de cadastro de unidade.');
      }
      return response.json();
    })
    .then(data => {
      console.log('Unidade cadastrada com sucesso:', data);
      console.log(data);

      // Após cadastrar a unidade com sucesso, fazer a segunda requisição para visualizarUltimo
      const requestOptions2 = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      };

      // URL do endpoint para visualizarUltimo
      const urlVisualizarUltimo = '/visualizarUltimoUni';

      // Executando a requisição para visualizarUltimo
      return fetch('/visualizarUltimoUni', requestOptions2);
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Erro na solicitação para obter o último registro de unidades.');
      }
      return response.json();
    })
    .then(data => {
      console.log('Último registro de unidades obtido:', data[0].idUnidadeProvedora);
      sessionStorage.setItem('IdUnidade', data[0].idUnidadeProvedora);
      window.location = '/dashboard'
     
    })
    .catch(error => {
      console.error('Erro durante a solicitação:', error);
      alert('Erro ao cadastrar a unidade.');
    });
}




        

</script>